<!DOCTYPE html>
<html lang="en" class=""> <!-- Add class for dark mode state -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Timetable Dashboard</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ApexCharts for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .dark ::-webkit-scrollbar-track {
            background: #2d3748;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4a5568;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
        /* Animation for sidebar and content */
        .sidebar, .main-content {
            transition: all 0.3s ease-in-out;
        }
        /* Custom class for the main view transition */
        .view-transition {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .view-hidden {
            opacity: 0;
            transform: translateY(10px);
            position: absolute;
            pointer-events: none;
        }
        /* Styling for generated markdown tables */
        .prose table { @apply w-full text-left border-collapse; }
        .prose th, .prose td { @apply border border-gray-300 dark:border-gray-600 px-4 py-2; }
        .prose th { @apply bg-gray-100 dark:bg-gray-700 font-semibold; }
        
        /* Spinner for loading state */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #4f46e5; /* Blue */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script>
        // Set theme on initial load safely
        try {
            if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        } catch (e) {
            console.error("Could not access localStorage for theme setting:", e);
        }
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 font-sans antialiased text-gray-800 dark:text-gray-200">

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar w-64 bg-white dark:bg-gray-800 shadow-lg flex flex-col shrink-0">
            <div class="p-4 flex items-center justify-between border-b dark:border-gray-700">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-indigo-600 rounded-lg text-white font-bold">AI</div>
                    <span class="logo-text font-semibold text-lg">Timetable AI</span>
                </div>
                <button id="toggle-btn" class="p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 lg:hidden">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
            
            <nav class="flex-1 px-4 py-4 space-y-2 overflow-y-auto">
                <a href="#" class="nav-item active" data-view="dashboard-view">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-view="timetables-view">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    <span class="nav-text">Timetables</span>
                </a>
                <a href="#" class="nav-item" data-view="faculty-view">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    <span class="nav-text">Faculty</span>
                </a>
                 <a href="#" class="nav-item" data-view="classrooms-view">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                    <span class="nav-text">Classrooms</span>
                </a>
                <a href="#" class="nav-item" data-view="reports-view">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                    <span class="nav-text">Reports</span>
                </a>
                <a href="#" class="nav-item" data-view="settings-view">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    <span class="nav-text">Settings</span>
                </a>
            </nav>
            <div class="p-4 border-t dark:border-gray-700">
                <a href="#" id="logout-button" class="nav-item">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    <span class="nav-text">Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 shadow-md p-4 flex justify-between items-center shrink-0">
                <div class="relative w-full max-w-md">
                    <svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    <input type="text" placeholder="Search..." class="w-full pl-10 pr-4 py-2 rounded-full bg-gray-100 dark:bg-gray-700 border-transparent focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                
                <div class="flex items-center gap-4">
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                        <svg id="theme-icon-light" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        <svg id="theme-icon-dark" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    </button>
                    <div class="relative">
                        <button id="user-menu-button" class="flex items-center gap-2">
                           <img src="https://placehold.co/40x40/667eea/ffffff?text=AD" alt="Admin" class="w-10 h-10 rounded-full">
                        </button>
                        <div id="user-menu" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl py-1 hidden">
                            <a href="#" class="dropdown-item">Profile</a>
                            <a href="#" class="dropdown-item">Settings</a>
                            <div class="border-t my-1 border-gray-200 dark:border-gray-700"></div>
                            <a href="#" id="logout-button-dropdown" class="dropdown-item">Logout</a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="flex-1 p-6 overflow-y-auto relative">
                <!-- Dashboard View -->
                <div id="dashboard-view" class="view-transition">
                    <h1 class="text-3xl font-bold mb-2">Welcome, Administrator!</h1>
                    <p class="text-gray-500 dark:text-gray-400 mb-6">Here's your intelligent scheduling summary for today.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="stat-card bg-indigo-500 text-white"><h3 class="font-semibold">Total Classrooms</h3><p class="text-4xl font-bold mt-2">32</p></div>
                        <div class="stat-card bg-blue-500 text-white"><h3 class="font-semibold">Faculty Members</h3><p class="text-4xl font-bold mt-2">86</p></div>
                        <div class="stat-card bg-green-500 text-white"><h3 class="font-semibold">Generated Timetables</h3><p class="text-4xl font-bold mt-2">42</p></div>
                        <div class="stat-card bg-yellow-500 text-white"><h3 class="font-semibold">Optimization Score</h3><p class="text-4xl font-bold mt-2">92%</p></div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="font-semibold text-lg mb-4">Classroom Utilization</h3>
                            <div id="utilizationChart"></div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                            <h3 class="font-semibold text-lg mb-4">Recent Activity</h3>
                            <ul class="space-y-4">
                                <!-- Interactive Conflict Item -->
                                <li id="conflict-activity-item" class="flex items-center gap-4 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer">
                                    <div class="p-3 bg-yellow-100 dark:bg-yellow-900 rounded-full"><svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div>
                                    <div>
                                        <p class="font-medium">Conflict detected in EE schedule.</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">3 days ago</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Timetables View -->
                <div id="timetables-view" class="view-transition view-hidden">
                     <h1 class="text-3xl font-bold mb-6">Manage Timetables</h1>
                     <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg text-center">
                        <p class="mb-4">Generate a new, optimized timetable using the power of AI.</p>
                        <button id="open-generator-modal" class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors">Generate New Timetable</button>
                    </div>
                </div>
                
                <!-- Other placeholder views -->
                <div id="faculty-view" class="view-transition view-hidden"><h1 class="text-3xl font-bold">Faculty</h1></div>
                <div id="classrooms-view" class="view-transition view-hidden"><h1 class="text-3xl font-bold">Classrooms</h1></div>
                <div id="reports-view" class="view-transition view-hidden"><h1 class="text-3xl font-bold">Reports</h1></div>
                <div id="settings-view" class="view-transition view-hidden"><h1 class="text-3xl font-bold">Settings</h1></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="logout-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">...</div>

    <!-- Timetable Generator Modal -->
    <div id="generator-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-3xl transform transition-all">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Timetable Generator</h2>
                <button id="close-generator-modal" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">&times;</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <textarea id="faculty-input" placeholder="Faculty Names (one per line, e.g., Prof. Smith, Dr. Jones)" class="modal-input" rows="5"></textarea>
                <textarea id="subjects-input" placeholder="Subjects (one per line, e.g., Physics 101, Intro to AI)" class="modal-input" rows="5"></textarea>
                <textarea id="classrooms-input" placeholder="Classrooms (one per line, e.g., Room 101, Lab A)" class="modal-input" rows="3"></textarea>
                <textarea id="constraints-input" placeholder="Additional Constraints (e.g., Prof. Smith cannot teach on Fridays, Physics 101 requires Lab A)" class="modal-input" rows="3"></textarea>
            </div>
            <div class="text-center mb-4">
                <button id="generate-with-ai" class="w-full md:w-auto px-8 py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2">
                    <span class="sparkle">✨</span> Generate with AI
                </button>
            </div>
            <div id="ai-result-container" class="mt-6 p-4 border rounded-lg bg-gray-50 dark:bg-gray-900 min-h-[200px] max-h-[40vh] overflow-y-auto prose dark:prose-invert max-w-none">
                 <div id="ai-result-placeholder" class="text-gray-500 text-center py-10">Your generated timetable will appear here.</div>
                 <div id="ai-result-loader" class="hidden justify-center items-center py-10"><div class="loader"></div></div>
                 <div id="ai-result-content"></div>
            </div>
        </div>
    </div>

    <!-- Conflict Resolver Modal -->
    <div id="conflict-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-2xl transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-yellow-600 dark:text-yellow-400">Conflict Detected</h2>
                <button id="close-conflict-modal" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">&times;</button>
            </div>
            <p class="mb-4">A scheduling conflict was found in the <strong>Electrical Engineering</strong> department timetable.</p>
            <div class="bg-red-100 dark:bg-red-900 border-l-4 border-red-500 text-red-700 dark:text-red-300 p-4 rounded-r-lg mb-6">
                <p><strong>Clash:</strong> Prof. Davis - EE201 (9 AM, Room 303) <br> <strong>With:</strong> Prof. Davis - EE305 (9 AM, Room 401)</p>
            </div>
            <div class="text-center mb-4">
                 <button id="resolve-with-ai" class="w-full md:w-auto px-8 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2">
                    <span class="sparkle">✨</span> Ask AI for Solutions
                </button>
            </div>
            <div id="conflict-result-container" class="mt-6 p-4 border rounded-lg bg-gray-50 dark:bg-gray-900 min-h-[150px]">
                <div id="conflict-result-placeholder" class="text-gray-500 text-center py-8">AI-powered solutions will appear here.</div>
                <div id="conflict-result-loader" class="hidden justify-center items-center py-8"><div class="loader"></div></div>
                <div id="conflict-result-content" class="prose dark:prose-invert max-w-none"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- ELEMENTS ---
            const themeToggle = document.getElementById('theme-toggle');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');
            const navItems = document.querySelectorAll('.nav-item');
            const views = document.querySelectorAll('.view-transition');

            // --- GEMINI API ELEMENTS ---
            const openGeneratorModalBtn = document.getElementById('open-generator-modal');
            const generatorModal = document.getElementById('generator-modal');
            const closeGeneratorModalBtn = document.getElementById('close-generator-modal');
            const generateWithAiBtn = document.getElementById('generate-with-ai');
            const aiResultContainer = document.getElementById('ai-result-container');
            const aiResultLoader = document.getElementById('ai-result-loader');
            const aiResultPlaceholder = document.getElementById('ai-result-placeholder');
            const aiResultContent = document.getElementById('ai-result-content');
            
            const conflictActivityItem = document.getElementById('conflict-activity-item');
            const conflictModal = document.getElementById('conflict-modal');
            const closeConflictModalBtn = document.getElementById('close-conflict-modal');
            const resolveWithAiBtn = document.getElementById('resolve-with-ai');
            const conflictResultLoader = document.getElementById('conflict-result-loader');
            const conflictResultPlaceholder = document.getElementById('conflict-result-placeholder');
            const conflictResultContent = document.getElementById('conflict-result-content');

            // --- THEME & VIEW LOGIC (abridged for brevity) ---
            const updateThemeIcon = () => { /* ... */ };
            themeToggle.addEventListener('click', () => { /* ... */ });
            navItems.forEach(item => { item.addEventListener('click', (e) => { /* ... */ }); });

            // --- GEMINI API CALL FUNCTION ---
            async function callGemini(prompt) {
                const apiKey = ""; // Leave empty, handled by environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.statusText}`);
                    }

                    const result = await response.json();
                    return result.candidates?.[0]?.content?.parts?.[0]?.text || "No content generated.";
                } catch (error) {
                    console.error("Gemini API call failed:", error);
                    return `Error: ${error.message}. Please check the console for details.`;
                }
            }
            
            // --- Markdown to HTML Table ---
            function markdownTableToHtml(markdown) {
                const lines = markdown.trim().split('\n');
                if (lines.length < 2) return markdown; // Not a table
                
                let html = '<table>';
                // Header
                const header = lines[0].split('|').map(h => h.trim()).filter(Boolean);
                html += '<thead><tr>';
                header.forEach(h => html += `<th>${h}</th>`);
                html += '</tr></thead>';

                // Body
                html += '<tbody>';
                for (let i = 2; i < lines.length; i++) {
                    const row = lines[i].split('|').map(c => c.trim()).filter(Boolean);
                    html += '<tr>';
                    row.forEach(c => html += `<td>${c}</td>`);
                    html += '</tr>';
                }
                html += '</tbody></table>';
                return html;
            }

            // --- TIMETABLE GENERATOR LOGIC ---
            openGeneratorModalBtn.addEventListener('click', () => generatorModal.classList.remove('hidden'));
            closeGeneratorModalBtn.addEventListener('click', () => generatorModal.classList.add('hidden'));

            generateWithAiBtn.addEventListener('click', async () => {
                const faculty = document.getElementById('faculty-input').value;
                const subjects = document.getElementById('subjects-input').value;
                const classrooms = document.getElementById('classrooms-input').value;
                const constraints = document.getElementById('constraints-input').value;

                if (!faculty || !subjects || !classrooms) {
                    alert("Please fill in Faculty, Subjects, and Classrooms.");
                    return;
                }

                aiResultPlaceholder.classList.add('hidden');
                aiResultLoader.style.display = 'flex';
                aiResultContent.innerHTML = '';
                generateWithAiBtn.disabled = true;

                const prompt = `
                    Act as an expert university timetable scheduler. Your task is to create an optimized 5-day (Monday to Friday) weekly class schedule from 9 AM to 5 PM.

                    **Input Data:**
                    - Faculty:
                    ${faculty}
                    - Subjects:
                    ${subjects}
                    - Classrooms:
                    ${classrooms}
                    - Additional Constraints:
                    ${constraints || 'None'}

                    **Your Goal:**
                    1.  Maximize resource utilization (classrooms and faculty).
                    2.  Avoid scheduling conflicts (a faculty member or classroom cannot be in two places at once).
                    3.  Distribute the workload as evenly as possible.
                    4.  Adhere to all constraints.

                    **Output Format:**
                    Provide the final timetable as a clean, easy-to-read Markdown table with the columns: "Day", "Time Slot", "Subject", "Faculty", "Classroom".
                `;

                const result = await callGemini(prompt);
                aiResultContent.innerHTML = markdownTableToHtml(result);
                aiResultLoader.style.display = 'none';
                generateWithAiBtn.disabled = false;
            });
            
             // --- CONFLICT RESOLVER LOGIC ---
            conflictActivityItem.addEventListener('click', () => conflictModal.classList.remove('hidden'));
            closeConflictModalBtn.addEventListener('click', () => conflictModal.classList.add('hidden'));

            resolveWithAiBtn.addEventListener('click', async () => {
                conflictResultPlaceholder.classList.add('hidden');
                conflictResultLoader.style.display = 'flex';
                conflictResultContent.innerHTML = '';
                resolveWithAiBtn.disabled = true;
                
                const prompt = `
                    Act as an intelligent scheduling conflict resolver. I have a conflict in my university timetable.

                    **Conflict Details:**
                    - **Faculty:** Prof. Davis
                    - **Time:** Monday, 9 AM
                    - **Clash:** Prof. Davis is scheduled for two classes at the same time:
                        1. Subject: EE201 in Room 303
                        2. Subject: EE305 in Room 401

                    **Your Task:**
                    Provide three distinct, creative, and actionable solutions to resolve this conflict. For each solution, briefly explain the pros and cons. Format your response clearly. For example:

                    **Solution 1: [Solution Title]**
                    * **Action:** [Describe the action]
                    * **Pros:** [List pros]
                    * **Cons:** [List cons]
                `;
                
                const result = await callGemini(prompt);
                // Simple markdown for lists and bold
                let htmlResult = result.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\* (.*?)\n/g, '<li>$1</li>');
                conflictResultContent.innerHTML = `<ul>${htmlResult}</ul>`;
                conflictResultLoader.style.display = 'none';
                resolveWithAiBtn.disabled = false;
            });


            // --- Standard Initializations (abridged) ---
            const isDesktop = () => window.innerWidth >= 1024;
            let sidebarOpen = isDesktop();
            const updateSidebar = () => { if (sidebarOpen) sidebar.classList.remove('-translate-x-full'); else sidebar.classList.add('-translate-x-full'); };
            updateSidebar();
            updateThemeIcon();
            // ... other initial setup from previous script
             const style = document.createElement('style');
            style.textContent = `
                .nav-item { @apply flex items-center gap-4 p-3 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-indigo-50 dark:hover:bg-gray-700 transition-colors; }
                .nav-item.active { @apply bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-300 font-semibold; }
                .dropdown-item { @apply block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700; }
                .stat-card { @apply p-6 rounded-xl shadow-lg transform hover:-translate-y-1 transition-transform duration-300; }
                .modal-input { @apply w-full p-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition; }
            `;
            document.head.append(style);
        });
    </script>
</body>
</html>

